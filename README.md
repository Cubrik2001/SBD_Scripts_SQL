# Proyecto LEGO - Base de Datos Oracle

## Descripci√≥n del Proyecto

Este proyecto contiene los scripts SQL para la implementaci√≥n de una base de datos Oracle que gestiona el sistema de negocio de LEGO, incluyendo:

- **Gesti√≥n de Clientes y Visitantes**: Control de personas con validaciones de edad y representantes legales
- **Cat√°logo de Productos**: Administraci√≥n de juguetes LEGO, precios y relaciones entre productos
- **Tours y Inscripciones**: Sistema de reservas y gesti√≥n de visitantes a los parques tem√°ticos
- **Inventario y Facturaci√≥n**: Control de tiendas, inventarios, facturas y operaciones comerciales
- **Estructura Geogr√°fica**: Manejo de pa√≠ses, estados y ciudades

**Versi√≥n de Oracle**: 23ai

---

## Estructura del Proyecto

```
/Lego_SBD
‚îÇ
‚îú‚îÄ‚îÄ README.md            <-- Este archivo: documentaci√≥n y orden de ejecuci√≥n
‚îÇ
‚îú‚îÄ‚îÄ /01_DCL              <-- (Data Control Language) Definici√≥n de estructuras
‚îÇ   ‚îî‚îÄ‚îÄ 01_tablas.sql    <-- Creaci√≥n de todas las tablas y constraints
‚îÇ
‚îú‚îÄ‚îÄ /02_PLSQL            <-- L√≥gica de Negocio (Triggers, Funciones, Procedimientos)
‚îÇ   ‚îî‚îÄ‚îÄ 01_triggers.sql  <-- Triggers de validaci√≥n de reglas de negocio
‚îÇ
‚îú‚îÄ‚îÄ /03_DML              <-- (Data Manipulation Language) Datos de prueba [POR IMPLEMENTAR]
‚îÇ   ‚îî‚îÄ‚îÄ init.txt         <-- Archivo placeholder (por implementar)
‚îÇ
‚îî‚îÄ‚îÄ /TCL                 <-- (Transaction Control Language) Control de transacciones [POR IMPLEMENTAR]
    ‚îî‚îÄ‚îÄ init.txt         <-- Archivo placeholder (por implementar)
```

---

## Descripci√≥n de Carpetas y Archivos

### üìÅ 01_DCL - Definici√≥n de Estructuras

Esta carpeta contiene los scripts para crear la estructura base de la base de datos.

#### `01_tablas.sql`
**Prop√≥sito**: Crear todas las tablas del sistema con sus constraints, claves primarias y for√°neas.

**Contenido**:
- **Tablas de Ubicaci√≥n**: `PAIS`, `ESTADOS`, `CIUDADES`
- **Personas**: `CLIENTES`, `VISITANTES`
- **Productos**: `PRODUCTOS_JUGUETES_LEGO`, `CATALOGO_PAIS`, `HIST_PRECIOS`, `PRODUCTOS_RELACION`
- **Temas y Tours**: `TEMAS`, `TEMAS_PRODUCTOS`, `TOURS`
- **Operaciones**: `INSCRIPCION`, `INSCRITOS`, `ENTRADAS`
- **Tiendas**: `TIENDAS`, `HORARIOS`
- **Facturaci√≥n e Inventario**: `FACTURAS_TIENDA`, `DETALLES_FACTURA`, `LOTES_INVENTARIO`, `DESCUENTO_L_INVENTARIO`

**Caracter√≠sticas**:
- Uso de `GENERATED BY DEFAULT ON NULL AS IDENTITY` para claves primarias auto-incrementales
- Constraints de integridad referencial (Foreign Keys)
- Constraints de unicidad (Unique Keys)
- Validaciones CHECK para campos con valores espec√≠ficos

---

### üìÅ 02_PLSQL - L√≥gica de Negocio

Esta carpeta contiene la l√≥gica program√°tica que implementa las reglas de negocio del sistema.

#### `01_triggers.sql`
**Prop√≥sito**: Implementar validaciones autom√°ticas mediante triggers que se ejecutan antes de insertar o actualizar datos.

**Triggers incluidos**:

1. **`TRG_VALIDAR_EDAD_CLIENTE`**
   - **Tabla**: `CLIENTES`
   - **Validaci√≥n**: Los clientes deben ser mayores de 21 a√±os
   - **C√°lculo**: Usa `MONTHS_BETWEEN()` para calcular la edad exacta
   - **Error**: `ORA-20001` si el cliente no cumple el requisito de edad

2. **`TRG_VALIDAR_VISITANTE`**
   - **Tabla**: `VISITANTES`
   - **Validaciones**:
     - **Regla A**: El visitante debe tener entre 12 y 20 a√±os (inclusive)
     - **Regla B**: Si es menor de 18 a√±os, **REQUIERE** un representante (`id_cliente_repres` no puede ser NULL)
     - **Regla C**: Si es mayor o igual a 18 a√±os, el representante es opcional
   - **Errores**: 
     - `ORA-20002` si la edad est√° fuera del rango permitido
     - `ORA-20003` si un menor de edad no tiene representante asignado

---

### üìÅ 03_DML - Datos de Prueba

**Estado**: ‚è≥ Por implementar

Esta carpeta contendr√° scripts para insertar datos de prueba que permitan validar el funcionamiento del sistema.

**Contenido planeado**:
- Pa√≠ses, estados y ciudades
- Clientes y visitantes de ejemplo
- Productos LEGO
- Tours y tiendas
- Otros datos necesarios para pruebas

---

### üìÅ TCL - Control de Transacciones

**Estado**: ‚è≥ Por implementar

Esta carpeta contendr√° scripts relacionados con el control de transacciones en Oracle.

**Contenido planeado**:
- `COMMIT`: Confirmar cambios permanentes
- `ROLLBACK`: Revertir cambios
- Puntos de guardado (`SAVEPOINT`)
- Control de transacciones distribuidas

---

## Orden de Ejecuci√≥n

Para inicializar correctamente la base de datos, ejecuta los scripts en el siguiente orden:

### 1Ô∏è‚É£ Paso 1: Crear Estructura Base
```sql
@01_DCL/01_tablas.sql
```
**Resultado**: Se crean todas las tablas, constraints, claves primarias y for√°neas.

**Verificaci√≥n**: 
```sql
SELECT table_name FROM user_tables ORDER BY table_name;
```

---

### 2Ô∏è‚É£ Paso 2: Implementar L√≥gica de Negocio
```sql
@02_PLSQL/01_triggers.sql
```
**Resultado**: Se crean los triggers que validan las reglas de negocio autom√°ticamente.

**Verificaci√≥n**:
```sql
SELECT trigger_name, table_name, status 
FROM user_triggers 
ORDER BY trigger_name;
```

---

### 3Ô∏è‚É£ Paso 3: Insertar Datos de Prueba [POR IMPLEMENTAR]

‚è≥ **Este paso a√∫n no est√° desarrollado**

**Contenido planeado**: Scripts DML para insertar datos de prueba que permitan validar el funcionamiento completo del sistema.

**Verificaci√≥n** (cuando est√© implementado): 
```sql
SELECT COUNT(*) FROM CLIENTES;
SELECT COUNT(*) FROM VISITANTES;
SELECT COUNT(*) FROM PRODUCTOS_JUGUETES_LEGO;
-- ... verificar otras tablas importantes
```

---

### 4Ô∏è‚É£ Paso 4: Control de Transacciones [POR IMPLEMENTAR]

‚è≥ **Este paso a√∫n no est√° desarrollado**

**Contenido planeado**: Scripts TCL para el manejo de transacciones.

---

## Validaci√≥n de Funcionamiento

#### Prueba de Triggers - Cliente Mayor de 21 a√±os:
```sql
-- Debe fallar (menor de 21 a√±os)
INSERT INTO CLIENTES (
    primer_nombre, primer_apellido, email, doc_identidad, 
    fecha_nacimiento, id_pais_res, id_pais_nac
) VALUES (
    'Juan', 'P√©rez', 'juan@email.com', '12345678',
    DATE '2010-01-01', 1, 1
);
-- Esperado: ORA-20001
```

#### Prueba de Triggers - Visitante con Rango de Edad:
```sql
-- Debe fallar (menor de 12 a√±os)
INSERT INTO VISITANTES (
    primer_nombre, primer_apellido, doc_identidad,
    fecha_nacimiento, id_pais_nac
) VALUES (
    'Ana', 'Garc√≠a', '87654321',
    DATE '2015-01-01', 1
);
-- Esperado: ORA-20002
```

#### Prueba de Triggers - Visitante Menor sin Representante:
```sql
-- Debe fallar (menor de 18 sin representante)
INSERT INTO VISITANTES (
    primer_nombre, primer_apellido, doc_identidad,
    fecha_nacimiento, id_pais_nac, id_cliente_repres
) VALUES (
    'Pedro', 'L√≥pez', '11223344',
    DATE '2010-01-01', 1, NULL
);
-- Esperado: ORA-20003
```

---

## Consideraciones Importantes

### Versi√≥n de Oracle
Este proyecto est√° dise√±ado para **Oracle Database 23ai**. Algunas caracter√≠sticas utilizadas:
- `GENERATED BY DEFAULT ON NULL AS IDENTITY` (disponible desde Oracle 12c)
- Tipos de datos `VARCHAR2`, `NUMBER`, `DATE`
- Funciones PL/SQL modernas

### Validaciones Implementadas

1. **Integridad Referencial**: Las claves for√°neas aseguran que los datos relacionados existan
2. **Unicidad**: Campos como `email` y `doc_identidad` no pueden duplicarse
3. **Reglas de Negocio**: Los triggers validan autom√°ticamente:
   - Edad m√≠nima de clientes (21 a√±os)
   - Rango de edad de visitantes (12-20 a√±os)
   - Requerimiento de representante para menores de 18 a√±os

### Convenciones de Nomenclatura

- **Tablas**: UPPER_CASE con guiones bajos
- **Constraints**: 
  - `PK_` para Primary Keys
  - `FK_` para Foreign Keys
  - `UQ_` para Unique Constraints
- **Triggers**: `TRG_` seguido de nombre descriptivo
- **Errores de aplicaci√≥n**: Rango `-20001` a `-20999`

---

## Estructura de Datos Principales

### Entidades Clave

1. **CLIENTES**: Personas mayores de 21 a√±os que pueden realizar compras
2. **VISITANTES**: Personas entre 12-20 a√±os que pueden inscribirse en tours
3. **PRODUCTOS_JUGUETES_LEGO**: Cat√°logo de productos disponibles
4. **TOURS**: Tours disponibles en los parques tem√°ticos
5. **TIENDAS**: Puntos de venta f√≠sicos
6. **INSCRIPCION**: Registro de inscripciones a tours

### Relaciones Importantes

- Un **VISITANTE** puede tener un **CLIENTE** como representante (si es menor de 18 a√±os)
- Un **INSCRIPCION** puede incluir m√∫ltiples **VISITANTES** (tabla `INSCRITOS`)
- Un **CLIENTE** puede realizar m√∫ltiples **FACTURAS_TIENDA**
- Los **PRODUCTOS** pueden estar relacionados entre s√≠ (tabla `PRODUCTOS_RELACION`)

---
**√öltima actualizaci√≥n**: 2025
**Versi√≥n Oracle**: 23ai

